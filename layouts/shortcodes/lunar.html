{{/*
  å†œå†æ˜¾ç¤º shortcode - åŸºäº lunisolar.js
  ç”¨æ³•ï¼š
  {{< lunar >}} - æ˜¾ç¤ºå½“å‰æ—¥æœŸçš„å†œå†ä¿¡æ¯
  {{< lunar date="2024-01-01" >}} - æ˜¾ç¤ºæŒ‡å®šæ—¥æœŸçš„å†œå†ä¿¡æ¯
  {{< lunar type="widget" >}} - æ˜¾ç¤ºå†œå†å°éƒ¨ä»¶
  {{< lunar type="simple" >}} - æ˜¾ç¤ºç®€å•çš„å†œå†ä¿¡æ¯
  {{< lunar type="card" >}} - æ˜¾ç¤ºå†œå†å¡ç‰‡
  {{< lunar format="date" >}} - è‡ªå®šä¹‰æ˜¾ç¤ºæ ¼å¼
*/}}

{{ $type := .Get "type" | default "default" }}
{{ $date := .Get "date" | default "" }}
{{ $class := .Get "class" | default "" }}

{{ if eq $type "widget" }}
  {{/* å†œå†å°éƒ¨ä»¶ - åŠ¨æ€æ˜¾ç¤ºå½“å‰å†œå†ä¿¡æ¯ */}}
  <div class="lunar-widget {{ $class }}" data-lunar-widget="true">
    <div class="bg-gradient-to-r from-amber-50 to-orange-50 rounded-lg p-4 border border-amber-200">
      <div class="flex items-center justify-center">
        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-amber-600"></div>
        <span class="ml-2 text-amber-700">åŠ è½½å†œå†ä¿¡æ¯ä¸­...</span>
      </div>
    </div>
  </div>

{{ else if eq $type "simple" }}
  {{/* ç®€å•å†œå†æ˜¾ç¤º */}}
  <div class="lunar-simple inline-block {{ $class }}" 
       {{ if $date }}data-date="{{ $date }}"{{ end }}>
    <span class="text-sm text-gray-600 bg-gray-100 px-2 py-1 rounded">
      <span class="lunar-loading">ğŸŒ™ å†œå†åŠ è½½ä¸­...</span>
    </span>
  </div>

{{ else if eq $type "card" }}
  {{/* å†œå†å¡ç‰‡æ˜¾ç¤º */}}
  <div class="lunar-card bg-white border border-gray-200 rounded-lg p-6 shadow-sm {{ $class }}"
       {{ if $date }}data-date="{{ $date }}"{{ end }}>
    <div class="flex items-center mb-4">
      <div class="w-8 h-8 bg-amber-100 rounded-full flex items-center justify-center mr-3">
        <span class="text-amber-600">ğŸŒ™</span>
      </div>
      <h3 class="text-lg font-semibold text-gray-900">å†œå†ä¿¡æ¯</h3>
    </div>
    <div class="lunar-content space-y-2">
      <div class="animate-pulse">
        <div class="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
        <div class="h-4 bg-gray-200 rounded w-1/2 mb-2"></div>
        <div class="h-4 bg-gray-200 rounded w-2/3"></div>
      </div>
    </div>
  </div>

{{ else }}
  {{/* é»˜è®¤å†œå†æ˜¾ç¤º */}}
  <div class="lunar-info inline-block {{ $class }}"
       {{ if $date }}data-date="{{ $date }}"{{ end }}>
    <span class="text-sm text-amber-700 bg-amber-50 px-2 py-1 rounded border border-amber-200">
      <span class="lunar-loading">å†œå†åŠ è½½ä¸­...</span>
    </span>
  </div>
{{ end }}

{{/* æ·»åŠ åˆå§‹åŒ–è„šæœ¬ - ä½¿ç”¨ lunisolar.js */}}
<script>
(function() {
  // ç­‰å¾… lunisolar åº“åŠ è½½å®Œæˆ
  function waitForLunisolar() {
    if (typeof window.lunisolar !== 'undefined') {
      initLunarShortcodes();
    } else {
      setTimeout(waitForLunisolar, 100);
    }
  }
  
  function initLunarShortcodes() {
    // å¤„ç†ç®€å•å†œå†æ˜¾ç¤º
    document.querySelectorAll('.lunar-simple').forEach(element => {
      const date = element.dataset.date;
      const lunar = date ? lunisolar(date) : lunisolar();
      const lunarText = lunar.format('lM(lL)lD');
      element.querySelector('.lunar-loading').textContent = `ğŸŒ™ ${lunarText}`;
    });
    
    // å¤„ç†é»˜è®¤å†œå†æ˜¾ç¤º
    document.querySelectorAll('.lunar-info').forEach(element => {
      const date = element.dataset.date;
      const lunar = date ? lunisolar(date) : lunisolar();
      const lunarText = lunar.format('lM(lL)lD');
      element.querySelector('.lunar-loading').textContent = lunarText;
    });
    
    // å¤„ç†å†œå†å¡ç‰‡
    document.querySelectorAll('.lunar-card').forEach(element => {
      const date = element.dataset.date;
      const lunar = date ? lunisolar(date) : lunisolar();
      
      const html = `
        <div class="space-y-2">
          <div class="text-gray-900">
            <span class="font-medium">å†œå†ï¼š</span>
            <span class="text-gray-700">${lunar.format('lYå¹´ lM(lL)lD')}</span>
          </div>
          <div class="text-gray-900">
            <span class="font-medium">å¹²æ”¯ï¼š</span>
            <span class="text-gray-700">${lunar.format('cY cM cD cH')}</span>
          </div>
          <div class="text-gray-900">
            <span class="font-medium">ç”Ÿè‚–ï¼š</span>
            <span class="text-gray-700">${lunar.format('cZ')}</span>
          </div>
          ${lunar.solarTerm ? `
            <div class="text-gray-900">
              <span class="font-medium">èŠ‚æ°”ï¼š</span>
              <span class="text-gray-700">${lunar.solarTerm.toString()}</span>
            </div>
          ` : ''}
        </div>
      `;
      
      element.querySelector('.lunar-content').innerHTML = html;
    });
    
    // å¤„ç†å†œå†å°éƒ¨ä»¶
    document.querySelectorAll('.lunar-widget').forEach(element => {
      const lunar = lunisolar();
      
      const html = `
        <div class="bg-gradient-to-r from-amber-50 to-orange-50 rounded-lg p-4 border border-amber-200">
          <div class="text-center">
            <div class="text-lg font-semibold text-amber-800 mb-2">
              ${lunar.format('lYå¹´ lM(lL)lD')}
            </div>
            <div class="text-sm text-amber-700 mb-1">
              å…¬å†ï¼š${lunar.format('YYYYå¹´MMæœˆDDæ—¥')}
            </div>
            <div class="text-sm text-amber-700 mb-1">
              å¹²æ”¯ï¼š${lunar.format('cY cM cD')}
            </div>
            <div class="text-sm text-amber-700">
              ç”Ÿè‚–ï¼š${lunar.format('cZ')}
            </div>
            ${lunar.solarTerm ? `
              <div class="text-sm text-amber-700 mt-2 px-2 py-1 bg-amber-100 rounded">
                ${lunar.solarTerm.toString()}
              </div>
            ` : ''}
          </div>
        </div>
      `;
      
      element.innerHTML = html;
    });
  }
  
  // å¦‚æœé¡µé¢å·²åŠ è½½å®Œæˆï¼Œç›´æ¥åˆå§‹åŒ–
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', waitForLunisolar);
  } else {
    waitForLunisolar();
  }
})();
</script>